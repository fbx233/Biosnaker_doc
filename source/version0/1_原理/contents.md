# 1.原理

从1977年的Sanger测序，再到1996年焦磷酸测序，2003年cmPCR和ZMW，以及现在第二代测序(NGS)技术的普及，处理高通量，大数据规模的测序数据已经成为了一种常规方法。

## 测序技术的迭代

第一代测序技术(Sanger测序)虽然有测序读长(可达1000bp)、测序准确率(高达99.999%)的优点，但是其测序成本高、通量(仪器一次测序产生的总数据量)低等缺点导致无法大规模应用。

第二代测序技术(NGS)有测序速度快、测序成本低、准确性高的优点，但其测序读长比第一代测序技术要短很多(一般100-150bp)。目前illumina是NGS的主流公司(采用Hisq技术)，其仪器的方法都是边合成边测序。

**表1**.测序技术以及其各自的优缺点

|     技术名称     |   年代   |                 优势                 |                   不足                    |
| :--------------: | :------: | :----------------------------------: | :---------------------------------------: |
|   **Sanger测序**   |  1977年  |  精度高，读长长，适用于小规模高准确度测序  | 通量低，速度慢，成本高，不适合大规模测序   |
|   **焦磷酸测序**   |  1996年  | 通量较高，速度快，无需电泳分离，实时检测信号 | 读长较短，对同聚物序列敏感，准确度受限     |
| **cmPCR和ZMW测序** |  2003年  | 单分子测序，无需PCR扩增，读长长，实时反应检测 | 错误率较高，设备昂贵，数据处理复杂         |
|    **NGS测序**    |   现在   | 高通量，成本低，速度快，适用于大规模测序    | 读长短，错误率较高，数据分析复杂，需强大计算资源 |




## Illumina NGS 测序技术
Illumina公司采用Hisq技术，通过克隆扩增和边合成边测序（SBS）的测序化学技术，实现了快速、准确的测序。该过程可在将DNA碱基整合到核酸链的同时对其进行识别。每个碱基在加入不断延伸的链时会发出独特的荧光信号，该信号可用于确定DNA序列的顺序。NGS技术能用于任何生物体的DNA测序，几乎可为所有生物学问题提供有价值的信息。DNA测序是一项高度可扩展的技术，可通过多种方法应用于小的目标区域或整个基因组，使研究人员能够研究并更好地了解健康和疾病。在目前高通量测序的科研领域，Illumina测序绝对是主导地位的，几乎没有其他的公司可以撼动它。详情可见[参考文章](https://zhuanlan.zhihu.com/p/560202547)


## scRNA（10X Genomic）单细胞测序技术
为了保证细胞在标记的过程中是单独分开的，10X公司开发了微流体设备(microfuidic device)进行预处理，设备有三个上样孔，可以分别加入你的
1.样本细胞悬液(Sample) 
2.凝胶小球(Beads) 
3.分离液(Oil)

微流体设备(microfuidic device)

当我们把样本细胞悬液加入设备时，每一个细胞会与凝胶小球单独结合，然后被分离液包裹，形成一个油包水的密闭小液滴(droplet)。进一步地，细胞和凝胶小球相遇不久后会裂解，释放出里面的各种物质，RNA(mRNA、tRNA、rRNA)，蛋白质，脂质，DNA等。实际上Beads上联接了不同的接头，其中有一个接头包含ploy(dT)序列，在细胞裂解后释放的核酸中，只有mRNA带有polyA tail，于是Beads的poly(dT)接头就可以从众多的裂解产物里捕获到mRNA(实际上drop-seq采用3'端测序，就是为了检测polyA tail)。

Master Mix中带有反转录试剂，当mRNA被捕获后，就可以从它的3‘端开始作为模板，进行反转录出cDNA的第一条链，这第一条链就沿着poly(dT)序列延申，长在了beads上，形成了图一7中的STAMPs，接着我们把反转录出来的cDNA序列洗脱，以cDNA的第一条链为模板，进行PCR，合成cDNA的第二条链，然后就是我们熟悉的cDNA扩增以及illumina测序。

那么如何确定测序序列来自哪个细胞？single cell的RNA-seq和bulk的RNA-seq的最大区别是什么？是barcode，或者说是cell barcode(实际上DNA自带barcode，cell barcode是人为控制的)。每一种single cell的beads上都有着相同的cell barcode(beads与beads间的cell barcode是不同的)，假设每个beads只捕获一个cell，那么则每个cell都被cell barcode 单独标记了。

如何保证每个beads只捕获一个cell？第一是控制cell和beads的流速，第二是beads的数目远远超过cell的数目，即绝大多数的beads都是空的，只有少数的才捕获到了cell。但是还是有个别的droplet里面会两个或者更多的细胞，这就需要进行质控(QualityControl)。

## 二代测序技术的不足

1.RNA-seq的测序误差主要由生物学误差(生物学重复，比如取30只小鼠采样)和技术性误差(技术性重复，比如对1只小鼠采样3次)造成，如果想要得到的数据为无偏的，那么生物学重复最重要，因为生物个体代表着样本，而技术手段只会造成不可控干扰。总的来说，只做技术性重复的实验结果偏差最大，技术性重复+生物学重复的实验结果偏差也可能较大，除非生物学重复远大于技术性重复(因为当生物学重复次数不足时，技术性重复能扩大样本单一的影响)，无论如何，多做生物学重复，这有助于你的结论被其他人复现。

2.RNA-seq的测序质量可能出现问题，实际上仪器会对碱基进行染色，然后判断颜色确定ATCG碱基，因此有很多原因会导致机器误判，和后续RNA-seq的质控有关。碱基质量差的常见原因有: 某些核苷酸对颜色附着不明显；大片区域颜色相同(相同类型核苷酸)，而其中仅有几个颜色不同的点(不同类型的核苷酸)。

## RNA上游分析

### 数据分析的基本思路

1. 寻找合适的数据：公开数据从NCBI的GEO或者其它数据库中查找自己感兴趣的RNASeq数据，同时也可以用自测的RNA数据

2. 对数据进行质量控制评价及处理（如果质量差的话，每个样本都应该处理）：可以用软件Fastqc+Trimmomatic配合使用,也可以用其它软件如Fastp替换

3. 去除rRNA等冗余信息：rRNA含量占RNA总量的80%以上，且提供的转录本信息非常少，浪费了宝贵的测序数据。所以，在RNA测序过程中，首先要解决的问题便是去除rRNA。

4. 将读段比对到参考基因组：这一步常用TopHat2、Cufflinks、Hisat和STAR等系列软件进行分析

5. 转录组组装：用Hisat、StringTie和Ballgown系列软件进行分析

6. 用R或者python构建基因表达矩阵，在此基础上进行差异表达分析和聚类分析

7. 此外，可以比较系列软件结果的差异表达分析和聚类分析

8. 结合其他下游分析：功能富集分析（GO、KEGG、Reactome、GSEA、GSVA、GRSA），时序分析（Mfuzz、TCseq），机器学习筛选候选基因（LASSO、随机森林、SVM等算法），基因共表达网络（WGCNA），免疫浸润分析等，结合多维度的，公开或非公开的验证集数据，从而得到候选基因与候选通路。

### 附：公开数据集下载
[参考这篇文章](https://www.jianshu.com/p/8dca09077df3)

#### 使用SRAtoolkit的prefetch命令下载SRA数据

```sh
for i in `seq 35 47`; 
do 
prefetch SRR68359${i} 
done
```

#### 使用SRAtoolkit的fastq-dump将SRA数据解析成fasta文件

由于sra文件是单端测序(此处具体参考sratoolkit工具的操作说明)，故而使用fastq-dump指令为：

```sh
fastq-dump  SRR6835947.sra
```


